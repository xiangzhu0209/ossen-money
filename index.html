<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>åº•å±¤æ•¸æ“šæ’ˆå–</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #222; color: #0f0; }
        .box { border: 1px solid #444; padding: 15px; margin-bottom: 20px; background: #111; word-break: break-all; }
        h1 { color: #fff; }
        .error { color: #ff5555; }
    </style>
</head>
<body>
    <h1>Ossen è³‡æ–™åº«åº•å±¤ç›´è®€</h1>
    <div id="status">æ­£åœ¨é€£ç·šè‡³ Google Firebase...</div>
    
    <div class="box">
        <h3>äº¤æ˜“ç´€éŒ„ (Transactions)</h3>
        <div id="tx-count">è®€å–ä¸­...</div>
        <div id="tx-data"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ä½ çš„åŸå§‹è¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyB_H154LeiZ2slCghAzLBy02xxqlT1-0wU",
            authDomain: "ossen-money.firebaseapp.com",
            projectId: "ossen-money",
            storageBucket: "ossen-money.firebasestorage.app",
            messagingSenderId: "910508291691",
            appId: "1:910508291691:web:cf44c7a77a5ea9e878232e",
            measurementId: "G-H1PR0LZZ4Q"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function dumpData() {
            try {
                // 1. å¼·åˆ¶æŠ“å– transactions é›†åˆçš„æ‰€æœ‰è³‡æ–™
                const querySnapshot = await getDocs(collection(db, "transactions"));
                
                document.getElementById('tx-count').innerHTML = `ğŸ”´ æƒæçµæœï¼šå…±ç™¼ç¾ <strong>${querySnapshot.size}</strong> ç­†è³‡æ–™`;
                
                if (querySnapshot.size === 0) {
                     document.getElementById('tx-data').innerHTML = "<span class='error'>è­¦å‘Šï¼šè³‡æ–™åº«å›å‚³ 0 ç­†è³‡æ–™ã€‚å¦‚æœä¸æ˜¯ç¶²è·¯å•é¡Œï¼Œå‰‡ä»£è¡¨è³‡æ–™åº«æ˜¯ç©ºçš„ã€‚</span>";
                } else {
                    let html = "<ul>";
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        // æŠŠæ¯ä¸€ç­†è³‡æ–™çš„ã€ŒåŸå§‹å†…å®¹ã€å°å‡ºä¾†
                        html += `<li>
                            <strong>ID:</strong> ${doc.id}<br>
                            <strong>æ—¥æœŸ:</strong> ${data.date || 'ç„¡'}<br>
                            <strong>é …ç›®:</strong> ${data.item}<br>
                            <strong>é‡‘é¡:</strong> ${data.amount}<br>
                            <strong>å¸³æœ¬:</strong> ${data.tab} (account=éŠ€è¡Œ, cash=ç¾é‡‘)<br>
                            <span style="color:#888">${JSON.stringify(data)}</span>
                            <hr style="border-color:#333">
                        </li>`;
                    });
                    html += "</ul>";
                    document.getElementById('tx-data').innerHTML = html;
                }

            } catch (error) {
                document.getElementById('status').innerHTML = `<span class='error'>é€£ç·šç™¼ç”Ÿè‡´å‘½éŒ¯èª¤ï¼š${error.message}</span>`;
            }
        }

        dumpData();
    </script>
</body>
</html>
